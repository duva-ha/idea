<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>XuÃ¢n App 2026 - Báº£n SiÃªu MÆ°á»£t</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #1a1a1a; font-family: sans-serif; }
        #container { position: relative; width: 100vw; height: 100vh; }
        canvas { position: absolute; width: 100%; height: 100%; object-fit: cover; }
        video { display: none; }
        
        /* Hiá»‡u á»©ng loading */
        #loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: gold; z-index: 1000; font-weight: bold; text-align: center; }
        
        .ui { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 100; display: flex; gap: 10px; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 40px; }
        button { padding: 12px 25px; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-mode { background: #444; color: white; }
        .btn-mode.active { background: #d32f2f; }
        .btn-snap { background: #ffd700; color: #000; }
    </style>
</head>
<body>

<div id="container">
    <div id="loader">ğŸš€ Äang khá»Ÿi Ä‘á»™ng AI...<br>(Vui lÃ²ng chá» vÃ i giÃ¢y)</div>
    <video id="video" autoplay playsinline></video>
    <canvas id="mainCanvas"></canvas>

    <div class="ui">
        <button id="btn-modern" class="btn-mode" onclick="changeMode('modern')">ğŸŒŠ BIá»‚N</button>
        <button id="btn-hongkong" class="btn-mode active" onclick="changeMode('hongkong')">ğŸ® HONGKONG</button>
        <button class="btn-snap" onclick="takeSnap()">ğŸ“¸ CHá»¤P áº¢NH</button>
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const loader = document.getElementById('loader');
    let currentMode = 'hongkong';

    const bgImages = {
        modern: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1280',
        hongkong: 'https://images.unsplash.com/photo-1596541539266-9b81e8f3d611?w=1280'
    };

    const imgBeach = new Image(); imgBeach.src = bgImages.modern;
    const imgHK = new Image(); imgHK.src = bgImages.hongkong;

    const selfie = new SelfieSegmentation({
        locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`
    });

    // Model 0 giÃºp app CHáº Y MÆ¯á»¢T HÆ N trÃªn mÃ¡y yáº¿u
    selfie.setOptions({ modelSelection: 0 }); 
    selfie.onResults(onResults);

    navigator.mediaDevices.getUserMedia({ video: { width: 1280, height: 720 } })
        .then(stream => {
            video.srcObject = stream;
            video.onloadeddata = () => {
                loader.style.display = 'none';
                sendToAI();
            };
        });

    function sendToAI() {
        selfie.send({image: video});
        requestAnimationFrame(sendToAI);
    }

    function onResults(results) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        ctx.save();
        // Váº½ ngÆ°á»i láº­t gÆ°Æ¡ng
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
        ctx.drawImage(results.segmentationMask, 0, 0, canvas.width, canvas.height);
        
        ctx.globalCompositeOperation = 'source-in';
        ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
        
        // Váº½ ná»n
        ctx.globalCompositeOperation = 'destination-over';
        ctx.drawImage(currentMode === 'modern' ? imgBeach : imgHK, 0, 0, canvas.width, canvas.height);
        
        ctx.restore();
    }

    function changeMode(m) {
        currentMode = m;
        document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${m}`).classList.add('active');
    }

    function takeSnap() {
        const link = document.createElement('a');
        link.download = 'Checkin_2026.png';
        link.href = canvas.toDataURL();
        link.click();
    }
</script>
</body>
</html>
