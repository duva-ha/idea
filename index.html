<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Xu√¢n 2026 - AI Photo Booth</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: sans-serif; }
        
        /* Video g√≥c r·ªông to√†n m√†n h√¨nh */
        #container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        video { position: absolute; width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); opacity: 0; }
        canvas#mainCanvas { position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 1; }

        /* Giao di·ªán ƒëi·ªÅu khi·ªÉn */
        .ui-panel { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 100; background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 20px; border-radius: 20px; display: flex; gap: 15px; border: 1px solid rgba(255,255,255,0.3); }
        button { padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-modern { background: #00d2ff; color: white; }
        .btn-classic { background: #d32f2f; color: white; }
        .btn-capture { background: #ffd700; color: #333; font-size: 1.1em; }
        
        #countdown { position: absolute; font-size: 150px; color: white; font-weight: bold; z-index: 200; display: none; text-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div id="container">
    <video id="video" autoplay playsinline></video>
    <canvas id="mainCanvas"></canvas>
    <div id="countdown">3</div>

    <div class="ui-panel">
        <button class="btn-modern" onclick="setMode('modern')">‚ú® Hi·ªán ƒê·∫°i (Bi·ªÉn & Tuy·∫øt)</button>
        <button class="btn-classic" onclick="setMode('classic')">üå∏ C·ªï ƒêi·ªÉn (Hoa Bay)</button>
        <button class="btn-capture" onclick="startCapture()">üì∏ CH·ª§P TO√ÄN M√ÄN H√åNH</button>
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    let currentMode = 'modern';
    let particles = [];

    // ·∫¢nh n·ªÅn bi·ªÉn cho ch·∫ø ƒë·ªô hi·ªán ƒë·∫°i
    const bgBeach = new Image();
    bgBeach.src = 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1920&q=80';

    // 1. C·∫•u h√¨nh AI T√°ch N·ªÅn
    const selfieSegmentation = new SelfieSegmentation({
        locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`
    });

    selfieSegmentation.setOptions({ modelSelection: 1 });
    selfieSegmentation.onResults(onResults);

    // 2. Kh·ªüi ƒë·ªông Camera g√≥c r·ªông
    navigator.mediaDevices.getUserMedia({ video: { width: 1920, height: 1080 } })
        .then(stream => {
            video.srcObject = stream;
            requestAnimationFrame(renderLoop);
        });

    function renderLoop() {
        selfieSegmentation.send({image: video});
        requestAnimationFrame(renderLoop);
    }

    function onResults(results) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        ctx.save();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // V·∫Ω N·ªÅn (N·∫øu l√† hi·ªán ƒë·∫°i th√¨ v·∫Ω bi·ªÉn, c·ªï ƒëi·ªÉn th√¨ v·∫Ω n·ªÅn ƒë·ªè nh·∫π)
        if (currentMode === 'modern') {
            ctx.drawImage(bgBeach, 0, 0, canvas.width, canvas.height);
        } else {
            ctx.fillStyle = '#4a0000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // T√°ch ng∆∞·ªùi v√† v·∫Ω v√†o gi·ªØa n·ªÅn
        ctx.globalCompositeOperation = 'destination-atop';
        ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
        
        ctx.globalCompositeOperation = 'destination-in';
        ctx.drawImage(results.segmentationMask, 0, 0, canvas.width, canvas.height);
        
        ctx.restore();
        ctx.globalCompositeOperation = 'source-over';

        // V·∫Ω hi·ªáu ·ª©ng lung linh (Hoa/Tuy·∫øt)
        updateParticles();
    }

    // 3. H·ªá th·ªëng h·∫°t lung linh
    function updateParticles() {
        if (particles.length < 50) {
            particles.push({
                x: Math.random() * canvas.width,
                y: -20,
                size: Math.random() * 10 + 5,
                speed: Math.random() * 2 + 1,
                color: currentMode === 'modern' ? '#fff' : '#ffb7c5'
            });
        }

        particles.forEach((p, i) => {
            p.y += p.speed;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
            if (p.y > canvas.height) particles.splice(i, 1);
        });
    }

    function setMode(mode) { currentMode = mode; particles = []; }

    function startCapture() {
        let count = 3;
        const cd = document.getElementById('countdown');
        cd.style.display = 'block';
        const t = setInterval(() => {
            count--;
            cd.innerText = count;
            if(count === 0) {
                clearInterval(t);
                cd.style.display = 'none';
                const link = document.createElement('a');
                link.download = 'Xuan2026_FullHD.png';
                link.href = canvas.toDataURL();
                link.click();
            }
        }, 1000);
    }
</script>
</body>
</html>
