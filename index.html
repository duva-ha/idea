<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xu√¢n App 2026 - Photo Booth</title>
    <style>
        :root { --tet-red: #d32f2f; --tet-gold: #ffd700; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #fff5f5; margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        h1 { color: var(---tet-red); margin-top: 20px; text-shadow: 1px 1px 2px #ccc; }
        
        /* Khu v·ª±c hi·ªÉn th·ªã Camera */
        #photo-area { position: relative; width: 640px; height: 480px; background: #000; border: 8px solid var(--tet-red); border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); } /* Mirror hi·ªáu ·ª©ng */
        canvas#overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; }
        
        /* B·ªô ƒë·∫øm ng∆∞·ª£c */
        #countdown { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 100px; font-weight: bold; z-index: 10; display: none; text-shadow: 0 0 20px rgba(0,0,0,0.5); }

        /* B·∫£ng ƒëi·ªÅu khi·ªÉn */
        .controls { margin-top: 20px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 640px; }
        .row { display: flex; justify-content: space-around; margin-bottom: 15px; gap: 10px; }
        
        button { padding: 10px 15px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; transition: 0.3s; }
        .btn-theme { background: #eee; color: #333; }
        .btn-theme:hover { background: var(--tet-gold); }
        .btn-capture { background: var(--tet-red); color: white; font-size: 1.1em; flex-grow: 1; }
        .btn-capture:disabled { background: #ccc; }

        input[type="text"] { padding: 10px; width: 70%; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>

    <h1>üèÆ XU√ÇN APP 2026 - PHOTO BOOTH üèÆ</h1>

    <div id="photo-area">
        <video id="video" autoplay playsinline></video>
        <canvas id="overlay" width="640" height="480"></canvas>
        <div id="countdown">3</div>
    </div>

    <div class="controls">
        <div class="row">
            <strong>Ch·ªß ƒë·ªÅ:</strong>
            <button class="btn-theme" onclick="setTheme('china_landscape')">TQ To√†n C·∫£nh</button>
            <button class="btn-theme" onclick="setTheme('china_avatar')">TQ Avatar</button>
            <button class="btn-theme" onclick="setTheme('vn_landscape')">VN To√†n C·∫£nh</button>
            <button class="btn-theme" onclick="setTheme('vn_avatar')">VN Avatar</button>
        </div>

        <div class="row">
            <input type="text" id="user-text" placeholder="Nh·∫≠p l·ªùi ch√∫c c·ªßa b·∫°n (VD: Ch√∫c m·ª´ng nƒÉm m·ªõi)...">
        </div>

        <div class="row">
            <button class="btn-capture" id="capture-btn" onclick="startCountdown()">CH·ª§P ·∫¢NH (H·∫∏N GI·ªú 3S)</button>
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const overlay = document.getElementById('overlay');
        const ctx = overlay.getContext('2d');
        const countdownEl = document.getElementById('countdown');
        const btnCapture = document.getElementById('capture-btn');

        // Gi·∫£ l·∫≠p link ·∫£nh PNG (B·∫°n h√£y thay b·∫±ng link ·∫£nh th·ª±c t·∫ø c√≥ n·ªÅn trong su·ªët)
        const themes = {
            'china_landscape': 'https://www.transparentpng.com/download/chinese-new-year/red-lanterns-chinese-new-year-png-15.png',
            'china_avatar': 'https://www.transparentpng.com/download/frame/golden-circle-chinese-frame-png-free-19.png',
            'vn_landscape': 'https://www.transparentpng.com/download/flower/cherry-blossom-flowers-png-2.png',
            'vn_avatar': 'https://www.transparentpng.com/download/frame/luxury-gold-frame-border-transparent-12.png'
        };

        let currentThemeImg = new Image();

        // 1. Kh·ªüi ƒë·ªông Camera
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => { video.srcObject = stream; })
            .catch(err => alert("Kh√¥ng th·ªÉ truy c·∫≠p Camera: " + err));

        // 2. H√†m ƒë·ªïi ch·ªß ƒë·ªÅ
        function setTheme(key) {
            currentThemeImg.crossOrigin = "anonymous";
            currentThemeImg.src = themes[key];
            currentThemeImg.onload = () => {
                drawOverlay();
            };
        }

        // V·∫Ω khung ƒë√® l√™n camera
        function drawOverlay() {
            ctx.clearRect(0, 0, overlay.width, overlay.height);
            if (currentThemeImg.src) {
                ctx.drawImage(currentThemeImg, 0, 0, overlay.width, overlay.height);
            }
        }

        // 3. H√†m ƒë·∫øm ng∆∞·ª£c
        function startCountdown() {
            let count = 3;
            countdownEl.style.display = 'block';
            btnCapture.disabled = true;
            
            const timer = setInterval(() => {
                count--;
                countdownEl.innerText = count;
                if (count === 0) {
                    clearInterval(timer);
                    countdownEl.style.display = 'none';
                    takePhoto();
                    btnCapture.disabled = false;
                    countdownEl.innerText = 3;
                }
            }, 1000);
        }

        // 4. H√†m ch·ª•p v√† x·ª≠ l√Ω ·∫£nh cu·ªëi c√πng
        function takePhoto() {
            const finalCanvas = document.createElement('canvas');
            finalCanvas.width = 640;
            finalCanvas.height = 480;
            const fCtx = finalCanvas.getContext('2d');

            // V·∫Ω Video (L·∫≠t ng∆∞·ª£c l·∫°i v√¨ camera ƒëang mirror)
            fCtx.translate(640, 0);
            fCtx.scale(-1, 1);
            fCtx.drawImage(video, 0, 0, 640, 480);
            fCtx.setTransform(1, 0, 0, 1, 0, 0); // Reset transform

            // V·∫Ω Overlay (Khung h√¨nh)
            fCtx.drawImage(overlay, 0, 0, 640, 480);

            // V·∫Ω l·ªùi ch√∫c
            const userText = document.getElementById('user-text').value;
            if (userText) {
                fCtx.font = "bold 30px Arial";
                fCtx.fillStyle = "#ffd700";
                fCtx.textAlign = "center";
                fCtx.strokeStyle = "black";
                fCtx.lineWidth = 2;
                fCtx.strokeText(userText, 320, 450);
                fCtx.fillText(userText, 320, 450);
            }

            // T·∫£i ·∫£nh v·ªÅ
            const link = document.createElement('a');
            link.download = `Xuan2026_${Date.now()}.png`;
            link.href = finalCanvas.toDataURL('image/png');
            link.click();
        }

        // M·∫∑c ƒë·ªãnh ch·ªçn 1 theme
        setTheme('china_landscape');
    </script>
</body>
</html>
