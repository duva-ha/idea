<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Xu√¢n App 2026 - B·∫£n Ch·∫°y Th·ª≠</title>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; background: #fff5f5; margin: 0; padding: 20px; }
        .main-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        
        /* Khung hi·ªÉn th·ªã */
        #photo-booth { position: relative; width: 640px; height: 480px; border: 10px solid #d32f2f; border-radius: 15px; overflow: hidden; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        canvas#overlay-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        
        /* N√∫t b·∫•m */
        .menu { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn { padding: 12px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .btn-red { background: #d32f2f; color: white; }
        .btn-gold { background: #ffc107; color: #333; }
        .btn:hover { opacity: 0.8; transform: translateY(-2px); }
        
        #countdown { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 120px; z-index: 20; display: none; text-shadow: 0 0 20px red; }
    </style>
</head>
<body>

    <h1 style="color: #d32f2f;">üèÆ PH·∫¶N M·ªÄM CH·ª§P ·∫¢NH T·∫æT 2026 üèÆ</h1>

    <div class="main-container">
        <div id="photo-booth">
            <video id="webcam" autoplay playsinline></video>
            <canvas id="overlay-canvas" width="640" height="480"></canvas>
            <div id="countdown">3</div>
        </div>

        <div class="menu">
            <div style="margin-bottom: 15px;">
                <strong>Ch·ªçn Phong N·ªÅn:</strong><br><br>
                <button class="btn btn-gold" onclick="updateFrame('vn_toancanh')">VN: Hoa ƒê√†o To√†n C·∫£nh</button>
                <button class="btn btn-gold" onclick="updateFrame('tq_avatar')">TQ: Khung Tr√≤n C·ªï Trang</button>
                <button class="btn btn-gold" onclick="updateFrame('tq_toancanh')">TQ: ƒê√®n L·ªìng ƒê·ªè</button>
            </div>
            
            <button class="btn btn-red" style="width: 100%; font-size: 1.2em;" onclick="captureSequence()">üì∏ CH·ª§P ·∫¢NH NGAY</button>
        </div>
    </div>

    <script>
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('overlay-canvas');
        const ctx = canvas.getContext('2d');
        const countdownDisplay = document.getElementById('countdown');

        // Danh s√°ch link ·∫£nh PNG trong su·ªët ƒë√£ t√¨m ƒë∆∞·ª£c
        const frames = {
            'vn_toancanh': 'https://i.imgur.com/GiswT5X.png', // C√†nh ƒë√†o/mai trang tr√≠ g√≥c
            'tq_avatar': 'https://i.imgur.com/vH9X0p0.png',   // Khung tr√≤n h·ªça ti·∫øt Trung Hoa
            'tq_toancanh': 'https://i.imgur.com/mUnmCsc.png'  // ƒê√®n l·ªìng v√† r·ªìng
        };

        let activeFrame = new Image();
        activeFrame.crossOrigin = "anonymous";

        // M·ªü Camera
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => { video.srcObject = stream; })
            .catch(err => alert("L·ªói m·ªü camera: " + err));

        // H√†m ƒë·ªïi khung
        function updateFrame(key) {
            activeFrame.src = frames[key];
            activeFrame.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(activeFrame, 0, 0, canvas.width, canvas.height);
            };
        }

        // ƒê·∫øm ng∆∞·ª£c v√† ch·ª•p
        function captureSequence() {
            let count = 3;
            countdownDisplay.style.display = 'block';
            countdownDisplay.innerText = count;

            const interval = setInterval(() => {
                count--;
                countdownDisplay.innerText = count;
                if (count === 0) {
                    clearInterval(interval);
                    countdownDisplay.style.display = 'none';
                    doCapture();
                }
            }, 1000);
        }

        function doCapture() {
            const finalCanvas = document.createElement('canvas');
            finalCanvas.width = 640;
            finalCanvas.height = 480;
            const fCtx = finalCanvas.getContext('2d');

            // 1. V·∫Ω ng∆∞·ªùi (l·∫≠t g∆∞∆°ng cho t·ª± nhi√™n)
            fCtx.translate(640, 0);
            fCtx.scale(-1, 1);
            fCtx.drawImage(video, 0, 0, 640, 480);
            fCtx.setTransform(1, 0, 0, 1, 0, 0);

            // 2. V·∫Ω khung ƒë√® l√™n
            fCtx.drawImage(activeFrame, 0, 0, 640, 480);

            // 3. T·ª± ƒë·ªông t·∫£i v·ªÅ
            const link = document.createElement('a');
            link.download = 'AnhXuan2026.png';
            link.href = finalCanvas.toDataURL('image/png');
            link.click();
        }

        // Kh·ªüi t·∫°o m·∫∑c ƒë·ªãnh
        updateFrame('vn_toancanh');
    </script>
</body>
</html>
