<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Xu√¢n App 2026 - B·∫£n Fix L·ªói N·ªÅn</title>
    <style>
        :root { --do-tet: #d32f2f; --vang-mai: #ffd700; }
        body { font-family: 'Arial', sans-serif; background: #fff5f5; text-align: center; margin: 0; padding: 20px; }
        
        .camera-box { position: relative; width: 640px; height: 480px; margin: 20px auto; border: 10px solid var(--do-tet); border-radius: 20px; background: #000; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.3); }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        
        /* L·ªõp ph·ªß trang tr√≠ b·∫±ng CSS - Kh√¥ng lo l·ªói link ·∫£nh */
        .overlay-decoration { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; border: 25px solid transparent; border-image: url("https://www.transparentpng.com/download/frame/luxury-gold-frame-border-transparent-12.png") 30 round; }
        
        .lantern { position: absolute; font-size: 50px; z-index: 11; animation: swing 3s infinite ease-in-out; }
        @keyframes swing { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }

        .controls { background: white; width: 600px; margin: 0 auto; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .btn { padding: 12px 25px; margin: 5px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; }
        .btn-capture { background: var(--do-tet); color: white; width: 100%; margin-top: 15px; }
        .btn-theme { background: #f0f0f0; border: 2px solid #ddd; }
        .btn-theme.active { background: var(--vang-mai); border-color: var(--do-tet); }
        
        #countdown { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 100px; z-index: 100; display: none; text-shadow: 0 0 20px red; }
    </style>
</head>
<body>

    <h1 style="color: var(--do-tet);">üèÆ CH·ª§P ·∫¢NH XU√ÇN 2026 - ƒê√É FIX N·ªÄN üèÆ</h1>

    <div class="camera-box">
        <video id="video" autoplay playsinline></video>
        <div class="lantern" style="top: 10px; left: 20px;">üèÆ</div>
        <div class="lantern" style="top: 10px; right: 20px;">üèÆ</div>
        <canvas id="overlay-canvas" width="640" height="480" style="position: absolute; top:0; left:0; z-index:15;"></canvas>
        <div id="countdown">3</div>
    </div>

    <div class="controls">
        <h3>1. Ch·ªçn Ki·ªÉu Trang Tr√≠</h3>
        <button class="btn btn-theme active" onclick="changeTheme('vn')">T·∫øt Vi·ªát Nam (Hoa Mai)</button>
        <button class="btn btn-theme" onclick="changeTheme('tq')">T·∫øt Trung Hoa (R·ªìng V√†ng)</button>
        
        <input type="text" id="wish-text" placeholder="Nh·∫≠p l·ªùi ch√∫c..." style="width: 90%; padding: 10px; margin-top: 15px; border-radius: 5px; border: 1px solid #ddd;">
        
        <button class="btn btn-capture" onclick="startTimer()">üì∏ CH·ª§P V√Ä L∆ØU ·∫¢NH</button>
    </div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('overlay-canvas');
        const ctx = canvas.getContext('2d');
        const countdownEl = document.getElementById('countdown');

        // Kh·ªüi ƒë·ªông Camera
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => { video.srcObject = stream; })
            .catch(err => alert("H√£y cho ph√©p quy·ªÅn truy c·∫≠p Camera ƒë·ªÉ d√πng App!"));

        // Danh s√°ch "V·∫Ω" tr·ª±c ti·∫øp l√™n Canvas thay v√¨ d√πng link ·∫£nh
        function drawDecoration(type) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.lineWidth = 15;
            ctx.strokeStyle = '#d32f2f';
            ctx.strokeRect(0, 0, canvas.width, canvas.height); // V·∫Ω vi·ªÅn ƒë·ªè

            if (type === 'vn') {
                // V·∫Ω gi·∫£ l·∫≠p hoa mai v√†ng ·ªü c√°c g√≥c
                drawFlower(50, 50, '#ffd700');
                drawFlower(590, 50, '#ffd700');
                drawFlower(50, 430, '#ffd700');
                drawFlower(590, 430, '#ffd700');
            } else {
                // V·∫Ω gi·∫£ l·∫≠p h·ªça ti·∫øt Trung Hoa
                ctx.fillStyle = '#ffd700';
                ctx.font = '40px Arial';
                ctx.fillText('Á¶è', 300, 50); // Ch·ªØ Ph√∫c
                ctx.fillText('üßß', 50, 100);
                ctx.fillText('üßß', 550, 100);
            }
        }

        function drawFlower(x, y, color) {
            ctx.fillStyle = color;
            for(let i=0; i<5; i++) {
                ctx.beginPath();
                ctx.arc(x + Math.cos(i*72)*15, y + Math.sin(i*72)*15, 10, 0, Math.PI*2);
                ctx.fill();
            }
            ctx.fillStyle = 'orange';
            ctx.beginPath(); ctx.arc(x, y, 7, 0, Math.PI*2); ctx.fill();
        }

        function changeTheme(type) {
            document.querySelectorAll('.btn-theme').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            drawDecoration(type);
        }

        function startTimer() {
            let time = 3;
            countdownEl.style.display = 'block';
            const t = setInterval(() => {
                time--;
                countdownEl.innerText = time;
                if(time === 0) {
                    clearInterval(t);
                    countdownEl.style.display = 'none';
                    saveImage();
                    countdownEl.innerText = 3;
                }
            }, 1000);
        }

        function saveImage() {
            const out = document.createElement('canvas');
            out.width = 640; out.height = 480;
            const oCtx = out.getContext('2d');
            
            // V·∫Ω ng∆∞·ªùi
            oCtx.translate(640, 0); oCtx.scale(-1, 1);
            oCtx.drawImage(video, 0, 0, 640, 480);
            oCtx.setTransform(1, 0, 0, 1, 0, 0);
            
            // V·∫Ω khung v√† l·ªùi ch√∫c
            oCtx.drawImage(canvas, 0, 0);
            const wish = document.getElementById('wish-text').value;
            if(wish) {
                oCtx.font = "bold 30px Arial";
                oCtx.fillStyle = "yellow";
                oCtx.textAlign = "center";
                oCtx.shadowBlur = 5; oCtx.shadowColor = "black";
                oCtx.fillText(wish, 320, 440);
            }

            const link = document.createElement('a');
            link.download = 'Xuan2026.png';
            link.href = out.toDataURL();
            link.click();
        }

        // V·∫Ω m·∫∑c ƒë·ªãnh khi v·ª´a m·ªü
        setTimeout(() => drawDecoration('vn'), 1000);
    </script>
</body>
</html>
